# Gitリポジトリヒートマップ アプリケーション設計書

## 1. 概要
このアプリケーションは、指定されたGitリポジトリのコミット履歴を分析し、ファイルごとの変更頻度をヒートマップとして可視化します。実行時バイナリのみで使用できるようにGolangで実装します。

## 2. 主要機能
- Gitリポジトリのクローン/読み込み
- コミット履歴の解析
- ファイルごとの変更頻度の集計
- ファイル内の行単位での変更頻度の解析
- ヒートマップデータの生成
- 結果の可視化（WebPまたはSVG形式）

## 3. 技術スタック
- 言語: Go (golang)
- 主要パッケージ:
  - go-git: Gitリポジトリの操作
  - go-chart: データの可視化
  - encoding/json: データファイル出力
  - SVGまたはWebP生成用ライブラリ

## 4. アプリケーション構造
```
RepositoryHeatmap/
├── cmd/
│   └── repository-heatmap/    # メインアプリケーションエントリーポイント
│       └── main.go
├── internal/
│   ├── git/
│   │   ├── analyzer.go        # Gitリポジトリ解析
│   │   ├── commit.go          # コミットデータ解析
│   │   └── linetracker.go     # 行単位変更追跡
│   ├── heatmap/
│   │   ├── generator.go       # ヒートマップ生成
│   │   └── visualizer.go      # 可視化処理
│   └── utils/
│       └── helpers.go         # ユーティリティ関数
├── pkg/                       # 外部から使用可能なパッケージ
│   └── models/
│       └── heatmap.go         # ヒートマップデータモデル
├── test/                      # テストコード
├── go.mod                     # Go依存関係定義
├── go.sum                     # 依存関係チェックサム
├── Makefile                   # ビルド設定
└── README.md                  # プロジェクト説明
```

## 5. データフロー
1. リポジトリクローン/読み込み
2. コミット履歴の取得と解析
3. ファイルごとの変更頻度の集計
4. ファイル内の行単位での変更追跡
5. ヒートマップデータの生成
6. 結果の可視化

## 6. 出力形式
- JSONファイル: ファイルごとの変更履歴と頻度データを構造化して出力
  - 他のツールや生成AIが後に解釈しやすい形式
  - ファイルパス、変更回数、最終変更日時、コミット者情報などを含む
  - 各ファイルの行単位での変更頻度データを含む
- 画像ファイル: 
  - WebPまたはSVG形式でのヒートマップ可視化
  - リポジトリ全体のヒートマップ
  - 各ファイルの変更頻度に応じた色付けを表示した対応ファイル（ディレクトリ構造を表現）
  - 各ファイル内の行単位での変更頻度ヒートマップ（コードヒートマップ）

## 7. 可視化の詳細
- リポジトリ全体ヒートマップ:
  - ファイル変更頻度を色の濃淡で表現
  - ディレクトリ構造を階層的に可視化
- ファイル単位の色付け:
  - 変更頻度の高いファイルほど暖色系（赤）で表示
  - 変更頻度の低いファイルほど寒色系（青）で表示
  - 色のグラデーションでファイルの活動度を直感的に把握
- 行単位のヒートマップ:
  - ファイル内の各行の変更頻度を色の濃淡で表現
  - 頻繁に変更される行（ホットスポット）を視覚的に特定
  - コードの変更が集中する箇所を直感的に理解可能
  - ファイルコンテンツと合わせて表示するオプション

## 8. パフォーマンス考慮事項
- 大規模リポジトリの効率的な処理
- メモリ使用量の最適化
- goroutineを活用した並列処理の実装
- クロスプラットフォームビルド (Windows, macOS, Linux)

## 9. 配布形式
- スタンドアロン実行可能バイナリ
- プラットフォームごとのバイナリビルド
- 設定ファイル (YAML/TOML/JSON)

## 10. 今後の改善点
- インタラクティブな可視化
- リアルタイム更新
- カスタムメトリクスの追加
- レポート生成機能 